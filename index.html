<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Diary - å…¨åŠŸèƒ½å®Œç¾ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Noto+Serif+TC:wght@600&display=swap');
        
        :root {
            --ribbon-pink: #F4C2C2;
            --deep-rose: #D47381;
            --gingham: #ffe4e9;
            --glass-bg: rgba(255, 252, 249, 0.5);
            --glass-border: rgba(255, 255, 255, 0.7);
        }

        body {
            margin: 0; padding: 20px 15px;
            background-color: #fff;
            background-image: linear-gradient(90deg, var(--gingham) 50%, transparent 50%),
                              linear-gradient(var(--gingham) 50%, transparent 50%);
            background-size: 35px 35px;
            font-family: 'Noto Serif TC', serif;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; color: #5a4a4a;
            box-sizing: border-box; overflow: hidden;
        }

        .main-card {
            background: var(--glass-bg);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            width: 100%; max-width: 480px; height: 100%;
            padding: 25px; border-radius: 40px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px rgba(212, 115, 129, 0.15);
            box-sizing: border-box; display: flex; flex-direction: column;
        }

        h1 { font-family: 'Dancing Script', cursive; font-size: 2.5rem; color: var(--deep-rose); margin: 0; text-align: center; }
        .quote-box { text-align: center; font-size: 0.85rem; color: #888; font-style: italic; margin-bottom: 12px; min-height: 1.2rem; }

        .fixed-top { flex-shrink: 0; }

        .status-box {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 25px; padding: 18px; margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.6); text-align: center;
        }
        
        .summary-row {
            display: flex; justify-content: space-around;
            margin-top: 12px; padding-top: 10px;
            border-top: 1px dashed rgba(212, 115, 129, 0.2);
            font-size: 0.85rem;
        }
        .summary-item b { display: block; font-size: 1.1rem; color: var(--deep-rose); }

        .progress-bar-bg { width: 100%; height: 14px; background: rgba(255, 255, 255, 0.6); border-radius: 50px; overflow: hidden; margin: 10px 0; }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #FFD1DC, var(--deep-rose)); width: 0%; transition: width 1.2s ease; }

        /* æ—¥æœŸé¸æ“‡å™¨æ¨£å¼ */
        .date-container { text-align: center; margin-bottom: 10px; }
        #mainDate { 
            border: 1.5px solid var(--ribbon-pink); border-radius: 15px; 
            padding: 5px 15px; font-family: inherit; color: var(--deep-rose); 
            font-weight: bold; background: white;
        }

        .entry-row {
            background: rgba(255, 255, 255, 0.5); padding: 12px;
            border-radius: 20px; margin-bottom: 10px; border: 1px solid rgba(255, 255, 255, 0.8);
            display: flex; flex-direction: column; gap: 8px;
        }
        .row-main { display: flex; align-items: center; gap: 8px; }
        .type-select { border: 1.5px solid var(--ribbon-pink); border-radius: 10px; padding: 3px; color: var(--deep-rose); font-weight: bold; }
        .input-note { flex: 1; background: transparent; border: none; border-bottom: 2px solid var(--ribbon-pink); outline: none; font-size: 1rem; }
        .row-amount { display: flex; justify-content: flex-end; align-items: center; gap: 5px; }
        .input-amount { width: 90px; background: transparent; border: none; border-bottom: 2px solid var(--ribbon-pink); outline: none; text-align: right; font-weight: bold; color: var(--deep-rose); font-size: 1.2rem; }
        .btn-remove-row { background: none; border: none; color: #FFB7B7; cursor: pointer; font-size: 1.2rem; }

        button { transition: all 0.2s; cursor: pointer; font-family: inherit; }
        .btn-add { background: rgba(255, 255, 255, 0.7); border: 2px dashed var(--deep-rose); color: var(--deep-rose); width: 100%; padding: 8px; border-radius: 20px; margin-bottom: 8px; font-weight: bold; }
        .btn-save { background: linear-gradient(135deg, #FFB7B7, var(--deep-rose)); color: white; border: none; width: 100%; padding: 12px; border-radius: 50px; font-weight: 800; font-size: 1.1rem; box-shadow: 0 8px 20px rgba(212, 115, 129, 0.2); margin-bottom: 10px; }

        .history-section { flex: 1; overflow: hidden; display: flex; flex-direction: column; border-top: 2px solid rgba(212, 115, 129, 0.1); padding-top: 10px; }
        .history-scroll-area { overflow-y: auto; flex: 1; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.4); }
        .amt-in { color: var(--deep-rose); font-weight: bold; }
        .amt-out { color: #888; font-weight: bold; }

        .settings-panel { display: none; background: white; border-radius: 25px; padding: 20px; position: absolute; z-index: 100; width: 85%; left: 7.5%; top: 60px; box-shadow: 0 15px 40px rgba(0,0,0,0.15); border: 2px solid var(--ribbon-pink); }
    </style>
</head>
<body>

    <div class="main-card">
        <div class="fixed-top">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom:5px;">
                <span style="font-size: 1.5rem;">ğŸ€</span>
                <button onclick="toggleSettings()" style="background:none; border:none; color:var(--deep-rose); font-size: 1.2rem;">âš™ï¸</button>
            </div>

            <div id="settingsPanel" class="settings-panel">
                <p style="font-weight: bold; color: var(--deep-rose); text-align: center;">âœ¨ ç›®æ¨™è¨­å®š âœ¨</p>
                <input type="text" id="wishInput" placeholder="é¡˜æœ›åç¨±" style="width:100%; margin: 10px 0; padding:10px; border-radius:12px; border:1.5px solid #eee; box-sizing: border-box;">
                <input type="number" id="goalInput" placeholder="ç›®æ¨™é‡‘é¡" style="width:100%; margin-bottom:10px; padding:10px; border-radius:12px; border:1.5px solid #eee; box-sizing: border-box;">
                <button onclick="saveSettings()" class="btn-save" style="margin-bottom:0;">å„²å­˜è®Šæ›´</button>
            </div>

            <h1>Royal Diary</h1>
            <div id="dailyQuote" class="quote-box"></div>

            <div class="status-box">
                <p id="wishTitle" style="font-weight: 800; color: var(--deep-rose); margin:0;">æˆ‘çš„ç²¾ç·»è¨ˆç•«</p>
                <div class="progress-bar-bg"><div id="progressFill" class="progress-bar-fill"></div></div>
                <p style="margin:0; font-size:0.9rem; font-weight: 600;">
                    é”æˆ <span id="percentText" style="color:var(--deep-rose); font-size: 1.1rem;">0</span>% ($<span id="currentText">0</span> / $<span id="goalText">0</span>)
                </p>
                <div class="summary-row">
                    <div class="summary-item">ç´¯ç©å­˜å…¥<b id="totalIn">$0</b></div>
                    <div class="summary-item">ç´¯ç©æ”¯å‡º<b id="totalOut">$0</b></div>
                </div>
            </div>

            <div class="date-container">
                <input type="date" id="mainDate">
            </div>

            <div id="inputArea">
                <div class="entry-row">
                    <div class="row-main">
                        <select class="type-select"><option value="in">ğŸ’– å­˜å…¥</option><option value="out">ğŸ’¸ æ”¯å‡º</option></select>
                        <input type="text" class="input-note" placeholder="å¦³çš„ç²¾å½©é»æ»´...">
                        <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
                    </div>
                    <div class="row-amount"><span style="color:var(--deep-rose); font-size:0.8rem;">$</span><input type="number" class="input-amount" placeholder="0"></div>
                </div>
            </div>
            
            <button class="btn-add" onclick="addNewRow()">ï¼‹ å¢åŠ æ˜ç´°</button>
            <button class="btn-save" onclick="saveEntries()">å¯«å…¥æ˜ç´°ç´€éŒ„ âœ¨</button>
        </div>

        <div class="history-section">
            <div id="historyList" class="history-scroll-area"></div>
        </div>
        <button onclick="resetData()" style="color:#eee; border:none; background:none; font-size:10px; margin-top:5px; cursor:pointer;">RESET ALL</button>
    </div>

    <script>
        const quotes = ["æ¯ä¸€ç­†å°å°çš„ç´¯ç©ï¼Œéƒ½æ˜¯å¦³æœªä¾†çš„åº•æ°£ã€‚", "å„ªé›…çš„ç”Ÿæ´»ï¼Œå¾å­¸æœƒç†è²¡é–‹å§‹ã€‚", "é¡˜æœ›ä¹‹æ‰€ä»¥èƒ½å¯¦ç¾ï¼Œæ˜¯å› ç‚ºå¦³å¾æœªåœæ­¢åŠªåŠ›ã€‚", "æ¯ä¸€ä»½å„²è“„ï¼Œéƒ½æ˜¯å°å¤¢æƒ³çš„çŒæº‰ã€‚", "å­˜ä¸‹çš„ä¸åªæ˜¯éŒ¢ï¼Œæ›´æ˜¯å¦³å°æœªä¾†çš„æ‰¿è«¾ã€‚"];
        let goal = parseFloat(localStorage.getItem('final_goal')) || 5000;
        let wish = localStorage.getItem('final_wish') || "æˆ‘çš„ç²¾ç·»è¨ˆç•«";
        let history = JSON.parse(localStorage.getItem('final_history')) || [];

        window.onload = function() {
            document.getElementById('mainDate').value = new Date().toISOString().split('T')[0];
            updateQuote();
            updateUI();
        };

        function updateQuote() {
            document.getElementById('dailyQuote').innerText = `âœ¨ ${quotes[Math.floor(Math.random() * quotes.length)]}`;
        }

        function toggleSettings() {
            const p = document.getElementById('settingsPanel');
            p.style.display = (p.style.display === 'block') ? 'none' : 'block';
        }

        function saveSettings() {
            const g = document.getElementById('goalInput').value;
            const w = document.getElementById('wishInput').value;
            if(g) goal = parseFloat(g);
            if(w) wish = w;
            localStorage.setItem('final_goal', goal);
            localStorage.setItem('final_wish', wish);
            updateUI();
            toggleSettings();
        }

        function addNewRow() {
            const div = document.createElement('div');
            div.className = 'entry-row';
            div.innerHTML = `
                <div class="row-main">
                    <select class="type-select"><option value="in">ğŸ’– å­˜å…¥</option><option value="out">ğŸ’¸ æ”¯å‡º</option></select>
                    <input type="text" class="input-note" placeholder="å¦³çš„ç²¾å½©é»æ»´...">
                    <button class="btn-remove-row" onclick="removeRow(this)">Ã—</button>
                </div>
                <div class="row-amount"><span style="color:var(--deep-rose); font-size:0.8rem;">$</span><input type="number" class="input-amount" placeholder="0"></div>
            `;
            document.getElementById('inputArea').appendChild(div);
        }

        function removeRow(btn) {
            if (document.querySelectorAll('.entry-row').length > 1) btn.closest('.entry-row').remove();
        }

        function saveEntries() {
            const rows = document.querySelectorAll('.entry-row');
            const d = new Date(document.getElementById('mainDate').value);
            const dateStr = `${d.getFullYear()}.${d.getMonth()+1}.${d.getDate()}`;
            let hasData = false;

            rows.forEach(row => {
                const type = row.querySelector('.type-select').value;
                const note = row.querySelector('.input-note').value || (type === 'in' ? "å­˜å…¥" : "æ”¯å‡º");
                const amt = parseFloat(row.querySelector('.input-amount').value);
                if (!isNaN(amt) && amt > 0) {
                    history.unshift({ id: Date.now() + Math.random(), date: dateStr, note: note, amount: type === 'in' ? amt : -amt, type: type, ts: d.getTime() });
                    hasData = true;
                }
            });

            if(hasData) {
                history.sort((a, b) => b.ts - a.ts);
                localStorage.setItem('final_history', JSON.stringify(history));
                document.getElementById('inputArea').innerHTML = `<div class="entry-row"><div class="row-main"><select class="type-select"><option value="in">ğŸ’– å­˜å…¥</option><option value="out">ğŸ’¸ æ”¯å‡º</option></select><input type="text" class="input-note" placeholder="å¦³çš„ç²¾å½©é»æ»´..."><button class="btn-remove-row" onclick="removeRow(this)">Ã—</button></div><div class="row-amount"><span style="color:var(--deep-rose); font-size:0.8rem;">$</span><input type="number" class="input-amount" placeholder="0"></div></div>`;
                updateQuote();
                updateUI();
            }
        }

        function updateUI() {
            const totalIn = history.filter(h => h.type === 'in').reduce((s, i) => s + i.amount, 0);
            const totalOut = Math.abs(history.filter(h => h.type === 'out').reduce((s, i) => s + i.amount, 0));
            const balance = Math.max(0, totalIn - totalOut);

            document.getElementById('totalIn').innerText = `$${totalIn.toLocaleString()}`;
            document.getElementById('totalOut').innerText = `$${totalOut.toLocaleString()}`;
            document.getElementById('wishTitle').innerText = `âœ¨ ${wish} âœ¨`;
            document.getElementById('currentText').innerText = Math.floor(balance).toLocaleString();
            document.getElementById('goalText').innerText = goal.toLocaleString();

            let percent = Math.min((balance / goal) * 100, 100);
            document.getElementById('percentText').innerText = Math.floor(percent);
            document.getElementById('progressFill').style.width = percent + "%";

            const list = document.getElementById('historyList');
            list.innerHTML = history.map(h => `
                <div class="history-item">
                    <div><span style="font-size:0.75rem; color:#999;">${h.date}</span><br><b>${h.note}</b></div>
                    <div style="display:flex; align-items:center;">
                        <span class="${h.type === 'in' ? 'amt-in' : 'amt-out'}">${h.type === 'in' ? '+' : ''}${h.amount.toLocaleString()}</span>
                        <button onclick="deleteItem(${h.id})" style="background:none; border:none; color:#ddd; font-size:1.2rem; margin-left:8px;">Ã—</button>
                    </div>
                </div>
            `).join('') || '<p style="text-align:center; color:#ccc; margin-top:20px;">é–‹å§‹å¦³çš„åœ“å¤¢ä¹‹æ—…...</p>';
        }

        function deleteItem(id) {
            if(confirm("ç¢ºå®šåˆªé™¤å—ï¼Ÿ")) {
                history = history.filter(h => h.id !== id);
                localStorage.setItem('final_history', JSON.stringify(history));
                updateUI();
            }
        }

        function resetData() { if(confirm("ç¢ºå®šé‡ç½®å—ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
